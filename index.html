<!DOCTYPE html>
<html>
<head>
  <title>NeoClaw Guardian Demo</title>
</head>

<body style="font-family: Arial; padding: 40px">

<h2>üë∂ NeoClaw Child Safety Guardian</h2>

<h3>Child Chat</h3>
<textarea id="chat" rows="4" cols="50" placeholder="Child types message..."></textarea>

<h3>Incoming Message (Simulate Friend / Stranger)</h3>
<input id="incoming" placeholder="Simulate incoming message"/>
<button onclick="checkIncoming()">Send</button>

<h3>üë®‚Äçüë©‚Äçüëß Parent Dashboard</h3>
<div id="dashboard"></div>

<script>
const chat = document.getElementById("chat")
const incoming = document.getElementById("incoming")
const dashboard = document.getElementById("dashboard")

let incidents = []
let riskScore = 0

// ‚≠ê REPLACE WITH YOUR OPENAI KEY
const OPENAI_API_KEY = "PASTE_YOUR_KEY_HERE"


// ===============================
// CHILD MESSAGE CHECK
// ===============================
chat.addEventListener("input", async () => {
  const text = chat.value
  if (!text) return

  const harmful = await checkWithAI(text)

  if (harmful) {
    showWarning("‚ö† You are sending harmful content.")
    saveIncident("Child Sent", text)
    increaseRisk()
  }
})


// ===============================
// INCOMING MESSAGE CHECK
// ===============================
async function checkIncoming() {
  const text = incoming.value
  if (!text) return

  const harmful = await checkWithAI(text)

  if (harmful) {
    showWarning("‚ö† Harmful message received. Stay safe.")
    saveIncident("Received", text)
    increaseRisk()
  }
}


// ===============================
// AI MODERATION CHECK
// ===============================
async function checkWithAI(text) {
  try {
    const response = await fetch(
      "https://api.openai.com/v1/moderations",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + OPENAI_API_KEY
        },
        body: JSON.stringify({
          model: "omni-moderation-latest",
          input: text
        })
      }
    )

    const data = await response.json()
    return data.results[0].flagged

  } catch (err) {
    console.log("AI error", err)
    return false
  }
}


// ===============================
// UI FUNCTIONS
// ===============================
function showWarning(text) {
  const message = document.createElement("div")

  message.innerHTML = `<b>${text}</b>`

  message.style.position = "fixed"
  message.style.top = "20px"
  message.style.right = "20px"
  message.style.background = "red"
  message.style.color = "white"
  message.style.padding = "15px"
  message.style.zIndex = "9999"

  document.body.appendChild(message)
  setTimeout(() => message.remove(), 4000)
}

function saveIncident(type, text) {
  incidents.push({
    type,
    message: text,
    time: new Date().toLocaleString()
  })

  updateDashboard()
}

function increaseRisk() {
  riskScore += 10
}

function updateDashboard() {
  dashboard.innerHTML = `
    <h4>Risk Score: ${riskScore}</h4>
    ${incidents.map(i => `<p>‚ö† ${i.type}: ${i.message} ‚Äî ${i.time}</p>`).join("")}
  `
}
</script>

</body>
</html>
